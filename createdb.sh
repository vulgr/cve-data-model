#!/bin/bash

CUR_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# Location of the root of this repo
csvloc=${1:-${CUR_DIR}}

# Location to store generated DB, DB name is graph.db so
# a file of that name must not exist in this directory.
storeloc=${2:-"${CUR_DIR}/output"}

docker run --rm  \
  -v ${csvloc}:/var/lib/neo4j/import \
  -v ${storeloc}:/opt/db \
  neo4j \
  /var/lib/neo4j/bin/neo4j-import \
  --into /opt/db/graph.db  \
  --id-type string \
  --nodes:Vendor /var/lib/neo4j/import/vendor.csv \
  --nodes:Product /var/lib/neo4j/import/product.csv \
  --nodes:CVE /var/lib/neo4j/import/cve.csv \
  --nodes:CWE /var/lib/neo4j/import/cwe.csv \
  --nodes:ReferenceSource /var/lib/neo4j/import/refsource.csv \
  --nodes:ReferenceType /var/lib/neo4j/import/reftype.csv \
  --nodes:Reference /var/lib/neo4j/import/reference.csv \
  --relationships:Affects /var/lib/neo4j/import/relationships/Affects.csv \
  --relationships:CommonWeakness /var/lib/neo4j/import/relationships/CommonWeakness.csv \
  --relationships:HasReference /var/lib/neo4j/import/relationships/HasReference.csv \
  --relationships:FromRefSource /var/lib/neo4j/import/relationships/FromRefSource.csv \
  --relationships:IsRefType /var/lib/neo4j/import/relationships/IsRefType.csv \
  --relationships:Owns /var/lib/neo4j/import/relationships/Owns.csv

